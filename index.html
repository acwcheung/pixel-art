<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Pixel Art Maker</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<div class="panel">
		<form class="submit">
		<!-- the buttons in the form clicked, submit event triggered -->
			<div><label>Row</label><button class="row-minus change-grid">-</button><input type="number" name="row" value="10"><button class="row-add change-grid">+</button></div>
			<div><label>Column</label><button class="column-minus change-grid">-</button><input type="number" name="column" value="10"><button class="column-add change-grid">+</button></div>  
			<button>Create grid</button>
			<input type="color" name="box-color" value="#00ffff">
		</form>
		<div class="clear-reset">
			<button class="clear">Clear grid</button>
			<button class="reset">Reset grid</button>

		</div>
	</div>

	<table class="container" cellspacing="0"></table>

	<script>
		const container = document.querySelector('.container');
		const buttonGridChange = document.querySelectorAll('.change-grid');
		//value from input fields
		const row = document.querySelector('input[name=row]')
		const column = document.querySelector('input[name=column]')
		//build the grid 
		const submit = document.querySelector('.submit');
		const clear = document.querySelector('.clear');
		const reset = document.querySelector('.reset');
		//color control
		const inputColor = document.querySelector('input[type=color]');
		const defaultColor = "#00ffff";
		let boxes = [];
		let newColor = defaultColor;
		let rowsDiff = 0;
		let currentRows = 0;	
		
		function initialGrid(row, column) {
			//build the grid
			for(let r = 0; r < row; r++) {
				//create tr each time 
				tr = document.createElement('tr');
				container.appendChild(tr);
				for(let c = 0; c < column; c++) {
					td = document.createElement('td');
					container.childNodes[r].appendChild(td);					
				}				
			}
			//add the event listener and property
			boxes = document.querySelectorAll('td');
			boxes.forEach(box => {
				box.addEventListener('click', addColor);
				box.style.background = "none";
			});
		}

		function addRows(row, column) {
			for(let r = 0; r < row; r++) {
				tr = document.createElement('tr');
				container.appendChild(tr);
				for(let c = 0; c < column; c++) {
					td = document.createElement('td');
					//just add the column to the last row
					container.lastChild.appendChild(td);					
				}				
			}

			boxes = container.lastChild.querySelectorAll('td');
			boxes.forEach(box => {
				box.addEventListener('click', addColor);
				box.style.background = "none";									
			});			
		}

		function removeRows(row, column) {
			for(let r = 0; r < row; r++) {
				container.removeChild(container.lastChild);
			}
		}

		function addColumns(row, column) {
			for (let r = 0; r < row; r++) {
				for(let c = 0; c < column; c++) {
					td = document.createElement('td');
					//add one coloumn to each row
					container.childNodes[r].appendChild(td);				
				}	
			}
			
			for (let r = 0; r < row; r++) {
				//last child of each row
				let box = container.childNodes[r].lastChild;
				box.addEventListener('click', addColor);
				box.style.background = "none";									
			}
		}

		function removeColumns(row, column) {
			for (let r = 0; r < row; r++) {
				//last child of each row
				container.childNodes[r].removeChild(container.childNodes[r].lastChild);				
			}
		}

		//main function to decide how to build/ change the grid
		function createGrid(row, column) {
			currentRows = container.childNodes.length;
			rowsDiff = row - currentRows; //add
			container.childNodes[0] === undefined? currentColumns = 0:
				currentColumns = container.childNodes[0].childNodes.length;
			columnsDiff = column - currentColumns; //add
			//start with nothing
			if(currentRows === 0 && currentColumns === 0) {
				return initialGrid(row, column);
			}
			//row button is clicked only
			if(rowsDiff !== 0 && columnsDiff === 0) {
				if(rowsDiff > 0) {	//add row
					return addRows(rowsDiff, column);		
				} else {	//remove row
				rowsDiff = Math.abs(rowsDiff);
				return removeRows(rowsDiff, column);
				}
			}
			//column button is clicked
			if(rowsDiff === 0 && columnsDiff !== 0) {
				if(columnsDiff > 0) { //add coloumn
					return addColumns(row, columnsDiff);		
				} else {	//remove column
				columnsDiff = Math.abs(rowsDiff);
				return removeColumns(row, columnsDiff);
				}
			}
		}

		function handleCreate(e) {
			e.preventDefault();
			createGrid(row.value, column.value);
		}
		//row or column buttons clicked
		function handleChangeGrid(e) {
			if(e.target.className.includes('row')) {
				const num = parseInt(row.value);
				e.target.className.includes('minus') ? 
					row.value = num - 1: 
					row.value = num + 1;				 
			} else {
				const num = parseInt(column.value);
				e.target.className.includes('minus') ? 
					column.value = num - 1: 
					column.value = num + 1; 	
			}										
		}

		function handleClear() {
			boxes = document.querySelectorAll('td');
			boxes.forEach(box => {
				box.style.background = "none";
			})
		}

		function resetGrid() {
			container.innerHTML = '';
			newColor = defaultColor;
			inputColor.value = defaultColor;
			row.value = 10;
			column.value = 10;
		}

		function addColor(e) {
			box = e.target;
			if(box.style.background === "none") {
				box.style.background = newColor;			
			} else {
				box.style.background !== "none";
				box.style.background = "none";
			}			
		}
				
		submit.addEventListener('submit', handleCreate);
		buttonGridChange.forEach(button => button.addEventListener('click', handleChangeGrid));
		clear.addEventListener('click', handleClear);
		reset.addEventListener('click', resetGrid);
		inputColor.addEventListener('change', () => {
			newColor = inputColor.value;
		});
				
	</script>
</body>
</html>